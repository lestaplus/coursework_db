# ğŸ“š Library Management System

ĞšÑƒÑ€ÑĞ¾Ğ²Ğ° Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ° Ğ· Ğ´Ğ¸ÑÑ†Ğ¸Ğ¿Ğ»Ñ–Ğ½Ğ¸ **Â«Ğ‘Ğ°Ğ·Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…Â»**.

Backend-Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ— Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸ Ğ±Ñ–Ğ±Ğ»Ñ–Ğ¾Ñ‚ĞµĞºĞ¸. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÑ” ĞºĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼Ğ¸, ĞºĞ½Ğ¸Ğ¶ĞºĞ¾Ğ²Ğ¸Ğ¼ Ñ„Ğ¾Ğ½Ğ´Ğ¾Ğ¼, Ğ²Ğ¸Ğ´Ğ°Ñ‡ĞµÑ ĞºĞ½Ğ¸Ğ³ Ñ‚Ğ° Ğ¾Ğ±Ğ»Ñ–ĞºĞ¾Ğ¼ ÑˆÑ‚Ñ€Ğ°Ñ„Ñ–Ğ².


## ğŸ‘¥ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°

* **Ğ¨ĞµĞ²Ñ†Ğ¾Ğ² ĞĞ½Ğ°Ñ‚Ğ¾Ğ»Ñ–Ğ¹ Ğ†Ğœ-41**
* **Ğ ĞµÑƒÑ†ÑŒĞºĞ¸Ğ¹ ĞÑ€Ñ‚ĞµĞ¼ Ğ†Ğœ-41**


## ğŸ›  Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚ĞµĞº

| ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ñ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ |
|-----------|------------|
| ĞœĞ¾Ğ²Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼ÑƒĞ²Ğ°Ğ½Ğ½Ñ | TypeScript 5.9.3 / Node.js 20 |
| Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ… | PostgreSQL 17 |
| ORM | Prisma 7.1.0 |
| Web Framework | Express 5.2.1 |
| ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ | Docker + Docker Compose |
| Ğ¢ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ | Jest 30.2.0, Supertest 7.1.4 |
| ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ‘Ğ” | pgAdmin 4 |

---

## ğŸš€ ĞŸĞ¾Ñ‡Ğ°Ñ‚Ğ¾Ğº Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸

### ĞšĞ»Ğ¾Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ‚Ğ° Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ

```bash
# ĞšĞ»Ğ¾Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ
git clone https://github.com/lestaplus/coursework_db.git
cd coursework_db

# Ğ’ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ·Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚ĞµĞ¹
npm install
```

#### ĞÑĞ½Ğ¾Ğ²Ğ½Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ

Ğ¡ĞºĞ¾Ğ¿Ñ–ÑĞ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´Ñƒ:

```bash
cp .env.example .env
```

Ğ’Ğ¼Ñ–ÑÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñƒ `.env.example`:

```env
PORT=3000
DATABASE_URL="postgresql://postgres:passwd@localhost:5432/librarydb?schema=public"
```

#### Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğµ ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ

Ğ”Ğ»Ñ Ñ‚ĞµÑÑ‚Ñ–Ğ² Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¾ĞºÑ€ĞµĞ¼Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ» ÑĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğ°. Ğ¡ĞºĞ¾Ğ¿Ñ–ÑĞ¹Ñ‚Ğµ:

```bash
cp .env.test.example .env.test
```

Ğ’Ğ¼Ñ–ÑÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñƒ `.env.test.example`:

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5433/librarydb_test?schema=public"
```

## â–¶ï¸ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞºÑƒ

Ğ£ `package.json` Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚Ğ¾Ğ²Ğ°Ğ½Ğ¾ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¸ Ğ´Ğ»Ñ Ñ€Ñ–Ğ·Ğ½Ğ¸Ñ… Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ–Ğ² Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸.

## Ğ ĞµĞ¶Ğ¸Ğ¼ 1: Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ° Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±ĞºĞ° (Recommended)

### ĞšÑ€Ğ¾Ğº 1. Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ‘Ğ” + pgAdmin

ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¿Ñ–Ğ´Ğ½Ñ–Ğ¼Ğµ:

* Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñƒ Ğ‘Ğ” (Ğ¿Ğ¾Ñ€Ñ‚ **5432**)
* Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñƒ Ğ‘Ğ” (Ğ¿Ğ¾Ñ€Ñ‚ **5433**)
* pgAdmin (Ğ¿Ğ¾Ñ€Ñ‚ **5050**)

```bash
npm run docker:dev
```

### ĞšÑ€Ğ¾Ğº 2. ĞŸÑ–Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ±Ğ°Ğ·Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…

```bash
npm run prisma:generate
npm run prisma:migrate
npm run seed
```

### ĞšÑ€Ğ¾Ğº 3. Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²ĞµÑ€Ğ°

```bash
npm run dev
```

Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ±ÑƒĞ´Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ Ğ·Ğ° Ğ°Ğ´Ñ€ĞµÑĞ¾Ñ: [http://localhost:3000](http://localhost:3000)

## Ğ ĞµĞ¶Ğ¸Ğ¼ 2: ĞŸĞ¾Ğ²Ğ½Ñ–ÑÑ‚Ñ Ğ² Docker

Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ” Ñ– Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº, Ñ– Ğ±Ğ°Ğ·Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ñ… Ñƒ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°Ñ…. ĞšĞ¾Ğ´ ĞºĞ¾Ğ¼Ğ¿Ñ–Ğ»ÑÑ”Ñ‚ÑŒÑÑ Ğ² JavaScript.

```bash
# Ğ—Ğ±Ñ–Ñ€ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ·Ñ–Ğ²
npm run docker:build

# Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ–Ğ²
npm run docker:up

# Ğ—ÑƒĞ¿Ğ¸Ğ½ĞºĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ–Ğ²
npm run docker:down
```

Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ¸:

* **API**: [http://localhost:3000](http://localhost:3000)
* **pgAdmin**: [http://localhost:5050](http://localhost:5050)
  Email: `admin@gmail.com`
  Password: `admin`

## ğŸ§ª Ğ¢ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ

ĞŸÑ€Ğ¾Ñ”ĞºÑ‚ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” **Jest** Ğ´Ğ»Ñ Ñ–Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ñ–Ğ¹Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ.

### Ğ’Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚ A: Ğ†Ğ·Ğ¾Ğ»ÑŒĞ¾Ğ²Ğ°Ğ½Ñ– Ñ‚ĞµÑÑ‚Ğ¸ Ğ² Docker

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾:

* Ğ¿Ñ–Ğ´Ğ½Ñ–Ğ¼Ğ°Ñ” Ğ¾ĞºÑ€ĞµĞ¼Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ· Ñ‡Ğ¸ÑÑ‚Ğ¾Ñ Ğ‘Ğ”
* Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ” Ğ¼Ñ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ—
* Ğ¿Ñ€Ğ¾Ğ³Ğ°Ğ½ÑÑ” Ñ‚ĞµÑÑ‚Ğ¸
* Ğ²Ğ¸Ğ´Ğ°Ğ»ÑÑ” ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸ Ğ¿Ñ–ÑĞ»Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ

```bash
npm run docker:test
```

### Ğ’Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚ Ğ‘: Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ñ–Ğ²

Ğ¯ĞºÑ‰Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ `npm run docker:dev` (Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ° Ğ‘Ğ” Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ **5433**):

```bash
npm test
```

## ğŸ“‚ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾Ñ”ĞºÑ‚Ñƒ

```
coursework_db/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ init_library_schema.sql
â”‚   â”‚   â”œâ”€â”€ add_indexes.sql
â”‚   â”‚   â”œâ”€â”€ add_soft_delete_to_user.sql
â”‚   â”‚   â”œâ”€â”€ add_version_to_subscription.sql
â”‚   â”‚   â”œâ”€â”€ add_id_to_loan.sql
â”‚   â”‚   â””â”€â”€ add_check_constraints.sql
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ seed.ts
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ book.controller.ts
â”‚   â”‚   â”œâ”€â”€ loan.controller.ts
â”‚   â”‚   â”œâ”€â”€ payment.controller.ts
â”‚   â”‚   â”œâ”€â”€ subscription.controller.ts
â”‚   â”‚   â””â”€â”€ user.controller.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ book.service.ts
â”‚   â”‚   â”œâ”€â”€ loan.service.ts
â”‚   â”‚   â”œâ”€â”€ payment.service.ts
â”‚   â”‚   â”œâ”€â”€ subscription.service.ts
â”‚   â”‚   â””â”€â”€ user.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ book.routes.ts
â”‚   â”‚   â”œâ”€â”€ loan.routes.ts
â”‚   â”‚   â”œâ”€â”€ payment.routes.ts
â”‚   â”‚   â”œâ”€â”€ subscription.routes.ts
â”‚   â”‚   â””â”€â”€ user.routes.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ app.ts
â”‚   â”œâ”€â”€ server.ts
â”‚   â””â”€â”€ prisma.ts
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ book.test.ts
â”‚   â”‚   â”œâ”€â”€ loan.test.ts
â”‚   â”‚   â”œâ”€â”€ payment.test.ts
â”‚   â”‚   â”œâ”€â”€ subscription.test.ts
â”‚   â”‚   â””â”€â”€ user.test.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ payment.service.test.ts
â”‚   â”‚   â”œâ”€â”€ subscription.service.test.ts
â”‚   â”‚   â””â”€â”€ user.service.test.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ helpers/
â”‚   â”‚   â””â”€â”€ resetdb.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ server.test.ts
â”‚   â””â”€â”€ setup.test.ts
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ schema.md
â”‚   â”œâ”€â”€ CONTRIBUTIONS.md
â”‚   â””â”€â”€ queries.md
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ docker-compose.test.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ prisma.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ jest.config.js
â””â”€â”€ README.md
```

## ğŸ“¡ API Endpoints

### Users
- **GET** `/api/users` â€” ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ Ğ²ÑÑ–Ñ… ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²  
- **POST** `/api/users/register` â€” Ğ ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°  
- **GET** `/api/users/search` â€” ĞŸĞ¾ÑˆÑƒĞº ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° (Ğ·Ğ° email)  
- **DELETE** `/api/users/:id` â€” Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° (Soft Delete)  


### Books
- **POST** `/api/books` â€” Ğ”Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½Ñ Ğ½Ğ¾Ğ²Ğ¾Ñ— ĞºĞ½Ğ¸Ğ³Ğ¸  
- **GET** `/api/books/popular` â€” Ğ—Ğ²Ñ–Ñ‚: Ğ½Ğ°Ğ¹Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ–ÑˆÑ– ĞºĞ½Ğ¸Ğ³Ğ¸  
- **GET** `/api/books/genre/:id` â€” ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ ĞºĞ½Ğ¸Ğ³ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¶Ğ°Ğ½Ñ€Ñƒ  


### Loans
- **GET** `/api/loans/user/:userId` â€” ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´ Ğ¿Ğ¾Ğ·Ğ¸Ğº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°  
- **PATCH** `/api/loans/:id/return` â€” ĞŸĞ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ ĞºĞ½Ğ¸Ğ³Ğ¸  
- **DELETE** `/api/loans/expired` â€” Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ¾Ñ‡ĞµĞ½Ğ¸Ñ…/Ğ·Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑÑ–Ğ²  


### Payments
- **GET** `/api/payments` â€” Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ñ–Ğ²
- **GET** `/api/payments/analytics/revenue` â€” ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ Ğ·Ğ²Ñ–Ñ‚ Ğ¿Ğ¾ Ğ´Ğ¾Ñ…Ğ¾Ğ´Ğ°Ñ…  


### Subscriptions
- **PATCH** `/api/subscriptions/:id` â€” ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ Ğ¿Ñ–Ğ´Ğ¿Ğ¸ÑĞºĞ¸  

## ğŸ“š Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ

Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ Ğ·Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒÑÑ Ğ² Ğ¿Ğ°Ğ¿Ñ†Ñ– `docs/`:

* [**schema.md**](./docs/schema.md) â€” ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ‚Ğ° Ğ·Ğ²Ê¼ÑĞ·ĞºĞ¸ Ğ‘Ğ”
* [**queries.md**](./docs/queries.md) â€” ÑĞºĞ»Ğ°Ğ´Ğ½Ñ– SQL-Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ Ñ‚Ğ° Ğ°Ğ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ°
